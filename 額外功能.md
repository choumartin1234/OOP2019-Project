# 额外功能

## 日志功能

实现了一个包含4个日志等级（```debug,info,warning,error```），并可以**调整等级和输出流**的日志接口。 於```message.cpp```设定。
+ debug : 当 ```log_level == 1``` 时开启, 提供非常详尽的计算过程供开发者纠错 
+ info : 当 ```log_level <= 2 ``` 时开启, 提供建图重要过程的提示
+ warning : 当```log_level <= 3 ``` 时开启, 提示使用者潜在危险
+ error : 当```log_level <= 4``` 时开启, 指示使用者严重错误
+ 以上日志功能将会输出相关信息到使用者的终端机（命令行）上
+ 当 ```log_level == 5``` 时, 即关闭日志功能 , 仅会调用```Message::message()``` 函数作为标准输出。


### 示範調試--调整等级
(备注:此次调试环境为Ubuntu的Linux系统, 在Windows上也可顺利进行)

日志功能可算是一个**权限设定**, 比如让开发者拥有```debug``` 的权限, 让测试者能看到运行过程的```info```, 而使用者只能看到```warning```和```error```的提示信息。
当然, 也能够视不同情况弹性调整, 重点是**记录追踪**程序是如何运行的。

假设我们今天为开发者, 想要确保计算图能正确建立进行调试 。 
我们调整在```message.cpp```中更改```log_level``` 为1, 使得能报出所有信息方便调试。
我们利用OJ上的样例```example_all\data1.input``` 作为调试输入。
```make```编译后再利用文件重定向的方式进行调试：
 ```./main < data1.input > data1.out```

![](picture_test/test1.jpg)

如上图 (仅列出部份行), 可在命令行(终端机)中逐行看到```debug``` 的提示。
因为样例中输入皆正确 , 故没有报出```info``` , ```warning```, 及 ```error```。
而 ```data1.out``` 也与OJ上要求的输出一致


假设今天开发已经完毕要给用户使用，我们不必逐行告诉使用者计算图是如何运行的。
我们即可设定```log_level```為3, 意味者只会报出```warning``` 以及 ```error```。
重新编译再利用```example_all / data5.input``` 作为样例输入。

![](picture_test/test2.jpg)

如上图, 因为在过程中计算图进行除法运算时遇到除数为零, 故会报出```error```。
而因为```log_level```已调至3, 故不会报出```debug```和```info``` (本样例无```warning```)。

类似地, 假如今天使用者想关闭日志功能, 只要将```log_level```调整至5, 便不会有报错提示(如下图)。

![](picture_test/test3.jpg)


### 示範調試--调整输出流功能
(备注:此次调试环境为Ubuntu的Linux系统, 在Windows上也可顺利进行, 将```log_level```设定为1)

有时后, 我们并不一定想直接把结果输出到屏幕上、或者不想让一长串的报错信息如咒语般惊人的直接打到终端机(命令行)上。
这时,因为我们在输出时都不是直接调用```std::cin```, 我们可以**调用不同的```ostream```对象来更改输出位置**。
注意到```message.cpp```中有两个指向于输出流对象的指针
+ log_s : 日志功能, 预设为```std::cerr```, 会输出到终端机(命令行)上
+ message_s : 标准输出功能, 预设为```std::cout```, 我们用于作业的标准输出要求。

透过更改指针所指向的对象(如```ofstream```, ```sstream``` , ```clog```等等) 即可调整输出流

假定今天我们为调试者想记录调试过程到文件中。如下图, 我们可以开两个```fstream```对象记录之

![](picture_test/stream.jpg)

上图中, 预设```ferr```输出到```error.txt```记录日志信息, ```fout```输出到```output.txt```记录标准输出

我们再利用```data1.input``` 进行调试：```./main < data1.input```。

![](picture_test/stream_result.jpg)

可发现原目录下已经多了```error.txt```以及```output.txt```, 且正确输出。

## Graph和Session机制

可以分离不同的计算图和会话。一个会话管理着一个计算图中的一组变量取值状态。

## 字符串Parser

虽然没有要求，但我们提供了一个额外的工具，用于解析OJ测试时描述计算图操作的语言。
